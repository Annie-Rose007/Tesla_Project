---
title: "Tesla Casualties"
author: "Annie-Rose_Grenier"
date: "`r Sys.Date()`"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(ggrepel)
library(skimr)
library(dplyr)
td_csv <- read_csv("td-csv.csv")

```


Fondée au début des années 2000, Tesla a révolutionné l'industrie automobile en popularisant les véhicules électriques hautes performances et la technologie de conduite assistée. Cependant, l'entreprise fait face à une augmentation des questions concernant la sécurité de ses véhicules et des problèmes de qualité perçus.

La problématique centrale de cette analyse est de déterminer si les accidents mortels impliquant des véhicules Tesla sont principalement dus à une erreur humaine ou à des défaillances technologiques (robotique). Cette question est cruciale, car l'identification précise des causes permettrait de développer des mesures préventives efficaces pour réduire le nombre de décès.

Pour mener cette étude, nous nous appuierons sur une compilation de données accessible via le site web https://www.tesladeaths.com/. Cette base de données exhaustive inclut diverses sections, dont celle dédiée aux "Deaths" (Décès), qui comporte 23 variables pertinentes. Dans le cadre de cette analyse, nous nous concentrerons sur les variables suivantes :

* Year (l’année de l’accident)

* Date (MM/JJ/AAAA)

* Country (le pays)

* State (la province)

* Deaths (le compte total des décès)

* Description (la raison de l’accident)

* Tesla driver (décès du conducteur)

* Tesla occupant (décès des passagers)

* Other vehicle (décès des occupants dans une autre voiture)

* Cyclists/ Peds (décès de piétons ou cyclistes)

* Model (modèle du véhicule)

* Verified Tesla Autopilot Death (décès confirmé dû à l’autopilotage / autopilotage engagé lors de l’accident)

Cette approche méthodique, basée sur des données spécifiques, vise à apporter un éclairage objectif sur un enjeu de sécurité publique majeur lié aux nouvelles technologies automobiles.

```{r creer_nouveau_dataframe_select, include=FALSE}
#dataframe selectionner
Tesla_casualties <- td_csv %>%
  select(Year, Date, Country, State, Deaths, `Tesla driver`, `Tesla occupant`, `Other vehicle`, `Cyclists/ Peds`, Model, `Verified Tesla Autopilot Death`) %>%


#Remplacer les "-"
  mutate(State = na_if(State, "-"),
         `Tesla driver` = na_if(`Tesla driver`, "-"),
         `Tesla occupant` = na_if(`Tesla occupant`, "-"),
         `Other vehicle` = na_if(`Other vehicle`, "-"),
         `Cyclists/ Peds` = na_if(`Cyclists/ Peds`, "-"), 
         Model = na_if(Model, "-"),
         `Verified Tesla Autopilot Death` = na_if(`Verified Tesla Autopilot Death`, "-")) %>%

#Convertir les colonnes en types numerique
  mutate(across(
    c(`Tesla driver`, `Tesla occupant`, `Other vehicle`, `Cyclists/ Peds`, `Verified Tesla Autopilot Death`), as.numeric)) %>%
  
#Remplacer toutes les valeurs NA, etc par "0"
  mutate(across(
    c(`Tesla driver`, `Tesla occupant`, `Other vehicle`, `Cyclists/ Peds`, `Verified Tesla Autopilot Death`), replace_na, 0))

#Agreger les donnees pour compter chaque models (IL MANQUE CYB!!!!!!!!)
Model <- Tesla_casualties %>%
  filter(!is.na(Model), Model != "") %>%
  group_by(Model) %>%
  summarise(Model = n(), .groups = 'drop') %>%
  arrange(desc(Model))
 
  
  
#corriger l'erreur d'annees pour le case 431.1
  Tesla_casualties$Year[Tesla_casualties$Year == 431.1] <- 2024
  
#Afficher annees
print(Tesla_casualties %>% filter(Year == 2024))


#(nettoyer, filtrer et agréger)COMMENT RENDRE PLUS SIMPLE mutate(across(c('Tesla driver', etc), .fns = ~as.numeric(na_if(., "-"))))) %>%      replace_na(list('Tesla driver = 0, etc)) %>%



#regression lineair multiples

#convertir en facteurs variables catégorielles
Tesla_casualties$Model <- as.factor(Tesla_casualties$Model)
Tesla_casualties$`Verified Tesla Autopilot Death` <- as.factor(Tesla_casualties$`Verified Tesla Autopilot Death`)

#convertir en format numerique
Tesla_casualties$Year <- as.numeric(Tesla_casualties$Year)

#regression
Model_predictif <- lm(Deaths~ Year + Model + `Verified Tesla Autopilot Death`, data = Tesla_casualties)

#afficher résultat
summary(Model_predictif)




#Afficher les premiere lignes
head(Tesla_casualties)

#Verifier si colonne numérique
glimpse(Tesla_casualties)
```


```{r graph_deces_annees}
#totaliser les décès par années
Deaths_per_year <- Tesla_casualties %>%
  group_by(Year) %>%
  summarise(Deaths_per_year = sum(Deaths, na.rm = TRUE))
  

ggplot(data = Deaths_per_year, aes(x = Year, y = Deaths_per_year)) +
         geom_line(color = "red", linewidth = 1) +
         geom_point(color = "red", size = 3) +
         labs(title = "Évolution du nombre total de décès par an",
              x = "Années",
              y = "Nombre total de décès") +
  theme_minimal()

```
```{r summary_skim_stats_years_deaths}
summary(Deaths_per_year)
skim(Deaths_per_year)
knitr::kable(Deaths_per_year)

```



```{r graph_deces_pays}
#Totaliser deces par pays
Deaths_per_Country <- Tesla_casualties %>%
  group_by(Country) %>%
  summarise(Deaths_per_Country = sum(Deaths, na.rm = TRUE)) %>%
  
  
#trier pays par deces decroissant
  arrange(desc(Deaths_per_Country)) %>%
ggplot(aes(x = reorder(Country, -Deaths_per_Country), y = Deaths_per_Country)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Nombre totale de décès par pays (Tesla)",
       x = "Pays",
       y = "Décès") +
  theme_minimal() +
  
#option si les noms se chevauchent
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

print(Deaths_per_Country)

```

```{r summary_skim_stats}
#pk est ce que ca marche pas??????
summary(Deaths_per_Country)

```


```{r graph_deaths_usa_state}
#filtrer donnees pour États-Unis seulement
Deaths_per_state_USA <- Tesla_casualties %>%
  filter(Country == "USA") %>%
  mutate(State = fct_lump_n(State, n = 4, other_level = "Other")) %>%
  group_by(State) %>%
  summarise(Count = n()) %>%
  mutate(Pourcentage = Count / sum(Count) * 100) %>%

  
  #Bonne pratiques
  ungroup()

#creer graph à barres
ggplot(Deaths_per_state_USA, aes(x = "", y = Count, fill = State)) +
         geom_bar(stat = "identity", width = 1, color = "black") +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Purple") + #??? c'est vert ds le graphique
         geom_text(aes(label = paste0(round(Pourcentage, 0), "%")),
                   position = position_stack(vjust = 0.5),
                   color = "black",
                   size = 4,
                   fontface = "bold") +
  theme_void() +
  labs(title = "Nombre d'accidents par état aux États-Unis",
              fill = "États") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        legend.position = "right")

```

```{r summary_skim_stats_usa_state}
summary(Deaths_per_state_USA)
skim(Deaths_per_state_USA)
knitr::kable(Deaths_per_state_USA)

```


```{r graph_autopilote_deaths_and_model}
#pk est ce que le model CYB n'est pas dans le graphique????

# Rassembler les colonnes de décès spécifiques
Model_verified_autopilot_death <- Tesla_casualties %>%
  
  # Filtrer uniquement les cas où l'Autopilot a été "claimed" (non NA, ou 1)
  filter(`Verified Tesla Autopilot Death` == 1) %>%
  
  # Rassembler les colonnes spécifiques de décès
  pivot_longer(
    cols = c(`Tesla driver`, `Tesla occupant`, `Other vehicle`, `Cyclists/ Peds`),
    names_to = "Category",
    values_to = "Deaths_Count"
  ) %>%
  
  # Retirer les lignes où le nombre de décès est 0 ou NA après le pivot
  filter(Deaths_Count > 0, !is.na(Model)) %>%
  
  # Agréger le nombre total de décès par Catégorie et par Modèle de voiture
  group_by(Model, Category) %>%
  summarise(Total_Deaths = sum(Deaths_Count, na.rm = TRUE), .groups = 'drop')

Model_verified_autopilot_death <- ggplot(Model_verified_autopilot_death, aes(x = Category, y = Total_Deaths, fill = Model)) +
  geom_col(position = position_dodge(width = 0.9)) + # Barres groupées côte à côte
  labs(
    title = "Décès liés à l'Autopilot par catégorie de victime et modèle de voiture",
    x = "Catégorie de victime",
    y = "Nombre total de décès",
    fill = "Modèle Tesla" # Légende de remplissage
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Rotation des étiquettes X pour la lisibilité

# Afficher le graphique
print(Model_verified_autopilot_death)


#regression lineair multiples

#convertir en facteurs variables catégorielles
Tesla_casualties$Model <- as.factor(Tesla_casualties$Model)
Tesla_casualties$`Verified Tesla Autopilot Death` <- as.factor(Tesla_casualties$`Verified Tesla Autopilot Death`)

#convertir en format numerique
Tesla_casualties$Year <- as.numeric(Tesla_casualties$Year)

#regression
Model_predictif <- lm(Deaths~ Year + Model + `Verified Tesla Autopilot Death`, data = Tesla_casualties)

#afficher résultat
summary(Model_predictif)

#afficher résultat
summary(Model_predictif)
```

``{r summary_skim_autopilot_model_type_deaths}
summary(Model_verified_autopilot_death)
skim(Model_verified_autopilot_death)
knitr::kable(Model_verified_autopilot_death)

```


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
