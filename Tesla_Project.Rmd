---
title: "Tesla Casualties"
author: "Annie-Rose_Grenier"
date: "`r Sys.Date()`"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(ggrepel)
library(skimr)
library(dplyr)
library(forecast)
td_csv <- read_csv("td-csv.csv")

```


Fondée au début des années 2000, Tesla a révolutionné l'industrie automobile en popularisant les véhicules électriques hautes performances et la technologie de conduite assistée. Cependant, l'entreprise fait face à une augmentation des questions concernant la sécurité de ses véhicules et des problèmes de qualité perçus.

La problématique centrale de cette analyse est de *déterminer si les accidents mortels impliquant des véhicules Tesla sont principalement dus à une erreur humaine ou à des défaillances technologiques (robotique)*. Cette question est cruciale, car l'identification précise des causes permettrait de développer des mesures préventives efficaces pour réduire le nombre de décès.

Pour mener cette étude, nous nous appuierons sur une compilation de données accessible via le site web https://www.tesladeaths.com/. Cette base de données exhaustive inclut diverses sections, dont celle dédiée aux "Deaths" (Décès), qui comporte 23 variables pertinentes. Dans le cadre de cette analyse, nous nous concentrerons sur les variables suivantes du fichier csv:

* Year (l’année de l’accident)

* Country (le pays)

* State (l'État)

* Deaths (le compte total des décès)

* Tesla driver (décès du conducteur)

* Tesla occupant (décès des passagers)

* Other vehicle (décès des occupants dans une autre voiture)

* Cyclists/ Peds (décès de piétons ou cyclistes)

* Model (modèle du véhicule)

* Verified Tesla Autopilot Death (décès confirmé dû à l’autopilotage / autopilotage engagé lors de l’accident)

Cette approche méthodique, basée sur des données spécifiques, vise à apporter un éclairage objectif sur un enjeu de sécurité publique majeur lié aux nouvelles technologies automobiles.

```{r dataframe_select, include=FALSE}
#dataframe selectionner
Tesla_casualties <- td_csv %>%
  select(Year, Country, State, Deaths, `Tesla driver`, `Tesla occupant`, `Other vehicle`, `Cyclists/ Peds`, Model, `Verified Tesla Autopilot Death`) %>%


#Remplacer les "-"
  mutate(State = na_if(State, "-"),
         `Tesla driver` = na_if(`Tesla driver`, "-"),
         `Tesla occupant` = na_if(`Tesla occupant`, "-"),
         `Other vehicle` = na_if(`Other vehicle`, "-"),
         `Cyclists/ Peds` = na_if(`Cyclists/ Peds`, "-"), 
         Model = na_if(Model, "-"),
         `Verified Tesla Autopilot Death` = na_if(`Verified Tesla Autopilot Death`, "-")) %>%

#Convertir les colonnes en types numerique
  mutate(across(
    c(`Tesla driver`, `Tesla occupant`, `Other vehicle`, `Cyclists/ Peds`, `Verified Tesla Autopilot Death`), as.numeric)) %>%
  
#Remplacer toutes les valeurs NA, etc par "0"
  mutate(across(
    c(`Tesla driver`, `Tesla occupant`, `Other vehicle`, `Cyclists/ Peds`, `Verified Tesla Autopilot Death`), replace_na, 0))

#Agreger les donnees pour compter chaque modèles
Model <- Tesla_casualties %>%
  filter(!is.na(Model), Model != "") %>%
  group_by(Model) %>%
  summarise(Model = n(), .groups = 'drop') %>%
  arrange(desc(Model))
 
  
  
#corriger l'erreur d'annees pour le "case" 431.1
  Tesla_casualties$Year[Tesla_casualties$Year == 431.1] <- 2024
  
#Afficher annees
print(Tesla_casualties %>% filter(Year == 2024))


#(nettoyer, filtrer et agréger)COMMENT RENDRE PLUS SIMPLE mutate(across(c('Tesla driver', etc), .fns = ~as.numeric(na_if(., "-"))))) %>%      replace_na(list('Tesla driver = 0, etc)) %>%



#Afficher les premiere lignes
head(Tesla_casualties)

#Verifier si colonne numérique
glimpse(Tesla_casualties)
```

## Model 3 : Victime de son succès ou véritable défaut de sécurité ?

Nous nous penchons maintenant sur une interrogation centrale : quel modèle de voiture, lorsque l'autopilote est activé, est le plus susceptible d'être impliqué dans des accidents mortels ? Pour répondre à cette question, nous posons l'hypothèse que le Modèle 3, en raison de sa vaste diffusion, serait le plus représenté dans ces statistiques.

Afin de vérifier la validité de cette supposition, nous avons croisé les données de mortalité avec les modèles de véhicules spécifiquement impliqués dans des incidents où le système Autopilot était engagé. Bien que la popularité massive d'un modèle puisse influencer statistiquement le nombre d'incidents bruts, l'analyse des variables permet de distinguer si un modèle particulier se démarque par une récurrence plus élevée d'accidents technologiques.

Le graphique suivant présente la répartition des décès par modèle de voiture dans les cas où l'Autopilot a été formellement identifié comme étant actif ou ayant joué un rôle au moment de l'impact : 


```{r graph_autopilote_deaths_and_model}
  # Rassembler les colonnes de décès spécifiques
Model_verified_autopilot_death <- Tesla_casualties %>%
  
  # Filtrer uniquement les cas où l'Autopilot a été "claimed" (non NA, ou 1)
  filter(`Verified Tesla Autopilot Death` == 1) %>%
  
  # Rassembler les colonnes spécifiques de décès
  pivot_longer(
    cols = c(`Tesla driver`, `Tesla occupant`, `Other vehicle`, `Cyclists/ Peds`),
    names_to = "Category",
    values_to = "Deaths_Count"
  ) %>%
  
  # Retirer les lignes où le nombre de décès est 0 ou NA après le pivot
  filter(Deaths_Count > 0, !is.na(Model)) %>%
  
  # Agréger le nombre total de décès par Catégorie et par Modèle de voiture
  group_by(Model, Category) %>%
  summarise(Total_Deaths = sum(Deaths_Count, na.rm = TRUE), .groups = 'drop')

Model_verified_autopilot_death <- ggplot(Model_verified_autopilot_death, aes(x = Category, y = Total_Deaths, fill = Model)) +
  
  # Barres groupées côte à côte
  geom_col(position = position_dodge(width = 0.9)) + 
  labs(
    title = "Décès liés à l'Autopilot par catégorie de victime et modèle de voiture",
    x = "Catégorie de victime",
    y = "Nombre total de décès",
    
    # Légende de remplissage
    fill = "Modèle Tesla" 
  ) +
  theme_minimal() + 
  
  # Rotation des étiquettes X pour la lisibilité
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

# Afficher le graphique
print(Model_verified_autopilot_death)


#regression linéair multiples

#convertir en facteurs variables catégorielles
Tesla_casualties$Model <- as.factor(Tesla_casualties$Model)
Tesla_casualties$`Verified Tesla Autopilot Death` <- as.factor(Tesla_casualties$`Verified Tesla Autopilot Death`)

#convertir en format numerique
Tesla_casualties$Year <- as.numeric(Tesla_casualties$Year)

#regression
Model_predictif <- lm(Deaths~ Year + Model + `Verified Tesla Autopilot Death`, data = Tesla_casualties)

#afficher résultat
summary(Model_predictif)



```

L'analyse des données présentées dans le graphique "Décès liés à l'Autopilot par catégorie de victime et modèle de voiture" confirme visuellement l'hypothèse selon laquelle le Model 3 est le modèle de véhicule le plus susceptible d'être impliqué dans des accidents mortels lorsque l'autopilote est activé.

En observant attentivement le graphique, on constate que les barres associées au Model 3 (représentées par la couleur rouge dans les catégories "Tesla driver" et "Other vehicle") sont systématiquement les plus élevées. Cela indique un nombre absolu de décès supérieur pour ce modèle par rapport aux Model S, X et Y dans les principales catégories de victimes. Le graphique fournit un décompte brut qui valide l'hypothèse de l'utilisateur sur la base des fréquences absolues d'accidents.

Cependant, il est essentiel de souligner la limite de cette analyse. Le graphique se concentre uniquement sur le nombre total de décès et n'inclut aucune donnée sur le contexte crucial, comme le volume total de véhicules de chaque modèle en circulation ou le nombre total de kilomètres parcourus avec l'autopilote activé. Le Model 3 étant le véhicule le plus vendu de la gamme, sa présence accrue sur les routes peut mécaniquement gonfler les statistiques brutes d'accidents sans nécessairement indiquer un taux d'accidents proportionnellement plus élevé par kilomètre parcouru. L'analyse visuelle confirme la fréquence absolue la plus élevée pour le Model 3, mais une analyse plus rigoureuse nécessiterait des données d'exposition.

## Pilote automatique, danger réel : Qui paie le prix fort lors d'un accident ?

Au-delà du modèle de véhicule, il est essentiel de s’interroger sur la répartition des victimes au sein de l’habitacle et à l’extérieur de celui-ci. Nous posons ici la question suivante : qui est le plus susceptible de mourir lors d'un accident où l'autopilote est activé ?

Notre hypothèse est que les passagers (occupants de la Tesla) présentent une vulnérabilité accrue. Cette supposition repose sur l'idée que le conducteur, même en cas de distraction initiale, pourrait avoir un réflexe de survie instinctif lors de l'impact imminent, modifiant la trajectoire du véhicule d'une manière qui le privilégie inconsciemment, laissant ainsi les passagers plus exposés.

Pour vérifier cette théorie, nous allons analysé le graphique juste en haut qui présente les variables identifiant le rôle de chaque victime : le conducteurdu véhicule Tesla, les passagers du véhicule Tesla, les occupants des autres véhicules impliqués, ainsi que les usagers vulnérables (piétons et cyclistes). Cette distinction est cruciale pour comprendre si l'assistance à la conduite modifie la nature des risques pour les différentes personnes présentes sur la route.

Contrairement à notre hypothèse initiale, ce ne sont pas les passagers de la Tesla, mais bien les occupants des autres véhicules qui paient le plus lourd tribut. Le graphique illustre une prédominance marquée des décès dans la catégorie "Other vehicle". En comparaison, les catégories internes au véhicule (conducteur et passagers Tesla) affichent des chiffres bien moindres, mettant en lumière une disparité importante dans le bilan des victimes lors d'un accident sous l'autopilotage.

##  Frontières et collisions : Analyse mondiale et locale des accidents.     Ou     Focus USA : Quels États sont les plus touchés par les crashs Tesla ?

Avant même d'examiner le graphique spécifique, il est plausible de supposer que les États-Unis enregistrent le plus grand nombre d'accidents (ou de décès) impliquant des véhicules Tesla. Cette hypothèse repose sur le fait que les États-Unis possèdent la plus grande population de conducteurs au monde et, par conséquent, le plus grand nombre de véhicules et de kilomètres parcourus, ce qui augmente statistiquement la probabilité d'accidents par rapport à des pays plus petits comme le Danemark, la Nouvelle-Zélande ou la Suisse.



```{r graph_deces_pays}
#Totaliser deces par pays
Deaths_per_Country <- Tesla_casualties %>%
  group_by(Country) %>%
  summarise(Total_deaths = sum(Deaths, na.rm = TRUE)) %>%
  

#bonne pratique
  ungroup() %>%

  
#trier pays par deces decroissant
  arrange(desc(Total_deaths))

#Graphique à barre
ggplot(Deaths_per_Country, aes(x = reorder(Country, -Total_deaths), y = Total_deaths)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Nombre totale de décès par pays (Tesla)",
       x = "Pays",
       y = "Décès") +
  theme_minimal() +
  
#option si les noms se chevauchent
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

print(Deaths_per_Country)

```
```{r knitr_Deaths_per_Conutry}
knitr::kable(Deaths_per_Country)

```


En se référant au graphique intitulé "Nombre totale de décès par pays (Tesla)" présenté à l'écran, l'hypothèse est confirmée :
Le graphique indique clairement que les États-Unis (USA) sont le pays avec le plus grand nombre de décès enregistrés dans le cadre de cette analyse. La barre associée aux États-Unis est significativement plus haute que toutes les autres barres du graphique, dominant visuellement la répartition des décès par pays (Chine,Allemagne, Canada,etc.).

 Quels sont les États américains où l'Autopilot est le plus mis à l'épreuve ? Notre attention se porte sur le Massachusetts. Entre des infrastructures urbaines denses et des habitudes de conduite particulièrement nerveuses, cet État constitue un cas d'étude idéal pour savoir si l'IA de Tesla parvient à s'adapter à des environnements humains et physiques aussi exigeants.


```{r graph_deaths_usa_state}
#filtrer donnees pour États-Unis seulement
Deaths_per_state_USA <- Tesla_casualties %>%
  filter(Country == "USA") %>%
  mutate(State = fct_lump_n(State, n = 4, other_level = "Other")) %>%
  group_by(State) %>%
  summarise(Count = n()) %>%
  mutate(Pourcentage = Count / sum(Count) * 100) %>%

  
  #Bonne pratiques
  ungroup()

#creer graph à barres
ggplot(Deaths_per_state_USA, aes(x = "", y = Count, fill = State)) +
         geom_bar(stat = "identity", width = 1, color = "black") +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Green") +
         geom_text(aes(label = paste0(round(Pourcentage, 0), "%")),
                   position = position_stack(vjust = 0.5),
                   color = "black",
                   size = 4,
                   fontface = "bold") +
  theme_void() +
  labs(title = "Nombre d'accidents par état aux États-Unis",
              fill = "États") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        legend.position = "right")

```

L'examen du diagramme circulaire révèle une répartition géographique très marquée des accidents mortels. La Californie (CA) domine largement avec 38 % des décès, suivie de la Floride (FL) à 12 %, puis de New York (NY) et du Texas (TX) avec 4 % chacun. Les 43 % restants sont fragmentés entre les 46 autres États américains.

Ces chiffres confirment la prépondérance des États-Unis dans le bilan global, validant une partie de notre hypothèse. La concentration massive en Californie et en Floride s'explique logiquement par la densité de la flotte Tesla : ces États étant les marchés principaux de la marque, le volume de véhicules en circulation y est nettement plus élevé, ce qui augmente mécaniquement la probabilité d'accidents.

Cependant, un point fondamental doit être souligné : la grande majorité de ces accidents mortels ne sont pas dus à l'autopilotage. En effet, les données démontrent que le système d'aide à la conduite n'était pas activé dans la plupart de ces collisions. Cela suggère que le risque dépend davantage de facteurs humains ou de l'environnement routier traditionnel que d'une défaillance de l'IA.

Enfin, notre hypothèse concernant le Massachusetts est infirmée. Bien que nous redoutions son infrastructure complexe, cet État ne figure pas parmi les zones les plus touchées, prouvant que le volume total de kilomètres parcourus par la flotte reste le facteur prédictif le plus fiable, bien avant le tempérament des conducteurs locaux.


```{r knitr_Deaths_usa_state}
knitr::kable(Deaths_per_state_USA)

```


```{r graph_deces_annees}
#totaliser les décès par années
Deaths_per_year <- Tesla_casualties %>%
  group_by(Year) %>%
  summarise(Total_deaths = sum(Deaths, na.rm = TRUE))

#création de l'objet série temporelle (frequence = 1 pour donné annuelles)
ts_deaths <- ts(Deaths_per_year$Total_deaths,
                start = min(Deaths_per_year$Year),
                frequency = 1)
# Modélisation ARIMA automatique et prédiction (h = 5 ans)
fit_arima <- auto.arima(ts_deaths, allowdrift = TRUE)
pred_arima <- forecast(fit_arima, h = 5)

#intervalle de confiance
autoplot(pred_arima) +
  
#Graphique
  geom_line(data = fortify(ts_deaths), aes(x = x, y = y), color = "red", linewidth = 1) +
  geom_point(data = fortify(ts_deaths), aes(x = x, y =y), color = "red", size = 3) +
  labs(title = "Prédiction ARIMA du nombre total de décès par an",
       subtitle = "Données historiques (rouge) et projections (bleu)",
              x = "Années",
              y = "Nombre total de décès") +
  theme_minimal()
```
```{r summary_skim_stats_years_deaths}
summary(Deaths_per_year)
skim(Deaths_per_year)
knitr::kable(Deaths_per_year)

```
